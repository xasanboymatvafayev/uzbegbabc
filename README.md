# üåü FIESTA ‚Äî Telegram Food Delivery Bot

–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –µ–¥—ã —á–µ—Ä–µ–∑ Telegram: –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –±–æ—Ç, –ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞, —Å–∏—Å—Ç–µ–º–∞ –∫—É—Ä—å–µ—Ä–æ–≤ –∏ Telegram WebApp —Å —Ç—ë–º–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
fiesta_bot/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ main.py              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ api.py               # FastAPI –º–∏–Ω–∏-—Å–µ—Ä–≤–µ—Ä –¥–ª—è WebApp
‚îÇ   ‚îú‚îÄ‚îÄ config.py            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ .env
‚îÇ   ‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py          # SQLAlchemy Base
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ session.py       # –î–≤–∏–∂–æ–∫ –∏ —Å–µ—Å—Å–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ models/              # ORM –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ services/            # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ client/          # –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ —Ö—ç–Ω–¥–ª–µ—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin/           # –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ courier/         # –•—ç–Ω–¥–ª–µ—Ä—ã –¥–ª—è –∫—É—Ä—å–µ—Ä–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ keyboards/           # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ web_app/
‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îú‚îÄ‚îÄ style.css
‚îÇ   ‚îî‚îÄ‚îÄ script.js
‚îú‚îÄ‚îÄ alembic/                 # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îî‚îÄ‚îÄ requirements.txt
```

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª

```bash
cp .env.example .env
```

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ `.env`:

```env
BOT_TOKEN=your_bot_token            # –û—Ç @BotFather
ADMIN_IDS=123456789,987654321       # Telegram ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
DB_URL=postgresql+asyncpg://postgres:password@db:5432/fiesta
REDIS_URL=redis://redis:6379/0
SHOP_CHANNEL_ID=-1001234567890      # ID –∫–∞–Ω–∞–ª–∞ –¥–ª—è –∑–∞–∫–∞–∑–æ–≤
COURIER_CHANNEL_ID=-1009876543210   # ID –∫–∞–Ω–∞–ª–∞ –¥–ª—è –∫—É—Ä—å–µ—Ä–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
WEBAPP_URL=https://yourdomain.com   # URL –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
BOT_USERNAME=your_bot_username
```

### 2. –°–æ–∑–¥–∞–π—Ç–µ –∫–∞–Ω–∞–ª –¥–ª—è –∑–∞–∫–∞–∑–æ–≤

1. –°–æ–∑–¥–∞–π—Ç–µ Telegram-–∫–∞–Ω–∞–ª –∏–ª–∏ –≥—Ä—É–ø–ø—É
2. –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ ID –∫–∞–Ω–∞–ª–∞ –≤ `SHOP_CHANNEL_ID`

### 3. –†–∞–∑–º–µ—Å—Ç–∏—Ç–µ WebApp

WebApp –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ HTTPS. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ nginx –∫–∞–∫ —Ä–µ–≤–µ—Ä—Å-–ø—Ä–æ–∫—Å–∏ –ø–µ—Ä–µ–¥ —Å–µ—Ä–≤–∏—Å–æ–º `api`.

–ü—Ä–∏–º–µ—Ä nginx –∫–æ–Ω—Ñ–∏–≥–∞:
```nginx
server {
    listen 443 ssl;
    server_name yourdomain.com;
    
    location / {
        proxy_pass http://localhost:8000;
        proxy_set_header Host $host;
    }
}
```

---

## üöÄ –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose

```bash
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
docker-compose up -d --build

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f bot
docker-compose logs -f api

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down
```

---

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏–∏ (Alembic)

```bash
# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é
docker-compose run --rm migrate alembic revision --autogenerate -m "init"

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
docker-compose run --rm migrate alembic upgrade head

# –û—Ç–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
docker-compose run --rm migrate alembic downgrade -1
```

---

## ü§ñ –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

### –ö–ª–∏–µ–Ω—Ç
- `/start` ‚Äî –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
- `/shop` ‚Äî –û—Ç–∫—Ä—ã—Ç—å –º–∞–≥–∞–∑–∏–Ω (inline –∫–Ω–æ–ø–∫–∞ —Å WebApp)
- –ö–Ω–æ–ø–∫–∞ **"üì¶ –ú–æ–∏ –∑–∞–∫–∞–∑—ã"** ‚Äî –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤
- –ö–Ω–æ–ø–∫–∞ **"‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞—Å"** ‚Äî –ö–æ–Ω—Ç–∞–∫—Ç—ã
- –ö–Ω–æ–ø–∫–∞ **"üë• –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞"** ‚Äî –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
- `/admin` ‚Äî –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è ADMIN_IDS:
- üçî Taomlar ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–ª—é–¥–∞–º–∏ (CRUD)
- üìÇ Kategoriyalar ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
- üéÅ Promokodlar ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–æ-–∫–æ–¥–∞–º–∏
- üìä Statistika ‚Äî –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–¥–µ–Ω—å/–Ω–µ–¥–µ–ª—è/–º–µ—Å—è—Ü)
- üö¥ Kuryerlar ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—É—Ä—å–µ—Ä–∞–º–∏
- üì¶ Aktiv buyurtmalar ‚Äî –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã
- ‚öôÔ∏è Sozlamalar ‚Äî –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞–Ω–∞–ª–æ–≤

---

## üì¶ –°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤

| –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| NEW | –ü—Ä–∏–Ω—è—Ç ‚Äî –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑ |
| CONFIRMED | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω |
| COOKING | –ì–æ—Ç–æ–≤–∏—Ç—Å—è |
| COURIER_ASSIGNED | –ö—É—Ä—å–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω |
| OUT_FOR_DELIVERY | –ü–µ—Ä–µ–¥–∞–Ω –∫—É—Ä—å–µ—Ä—É |
| DELIVERED | –î–æ—Å—Ç–∞–≤–ª–µ–Ω ‚úÖ |
| CANCELED | –û—Ç–º–µ–Ω–µ–Ω ‚ùå |

---

## üö¥ –ö—É—Ä—å–µ—Ä—ã

1. –î–æ–±–∞–≤—å—Ç–µ –∫—É—Ä—å–µ—Ä–∞ –≤ `/admin ‚Üí Kuryerlar ‚Üí Kuryer qo'shish`
2. –£–∫–∞–∂–∏—Ç–µ chat_id –∏ –∏–º—è –∫—É—Ä—å–µ—Ä–∞
3. –ü—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –∫—É—Ä—å–µ—Ä—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
4. –ö—É—Ä—å–µ—Ä –Ω–∞–∂–∏–º–∞–µ—Ç **"‚úÖ –ü—Ä–∏–Ω—è—Ç—å –∑–∞–∫–∞–∑"** ‚Üí —Å—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ OUT_FOR_DELIVERY
5. –ö—É—Ä—å–µ—Ä –Ω–∞–∂–∏–º–∞–µ—Ç **"üì¶ –î–æ—Å—Ç–∞–≤–ª–µ–Ω"** ‚Üí —Å—Ç–∞—Ç—É—Å DELIVERED, –≤—ã—Ä—É—á–∫–∞ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ

---

## üéÅ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

- –°—Å—ã–ª–∫–∞: `https://t.me/{BOT_USERNAME}?start={user_id}`
- –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è –∫ —Ä–µ—Ñ–µ—Ä—É
- –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ 3 –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö –¥—Ä—É–∑–µ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–æ–º–æ-–∫–æ–¥ –Ω–∞ —Å–∫–∏–¥–∫—É 15%

---

## üì± WebApp

WebApp —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ Telegram WebApp API:
- –¢—ë–º–Ω—ã–π –¥–∏–∑–∞–π–Ω
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±–ª—é–¥
- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è (—Ä–µ–π—Ç–∏–Ω–≥, –Ω–æ–≤–∏–Ω–∫–∏, —Ü–µ–Ω–∞)
- –ö–æ—Ä–∑–∏–Ω–∞ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Å—É–º–º–æ–π 50 000 —Å—É–º
- –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è)
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–æ-–∫–æ–¥–æ–≤
- –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–∞ —á–µ—Ä–µ–∑ `sendData`

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∏–∑ `ADMIN_IDS`
- –ö—É—Ä—å–µ—Ä—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫—É—Ä—å–µ—Ä–æ–≤ (–∏–∑ –ë–î)
- WebApp initData –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ HMAC-SHA256
- –í—Å–µ ID —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ PostgreSQL —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏

---

## üìä API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|----------|
| GET | `/api/categories` | –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π |
| GET | `/api/foods?category_id=&sort=` | –°–ø–∏—Å–æ–∫ –±–ª—é–¥ |
| GET | `/api/promo/validate?code=` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–º–æ-–∫–æ–¥ |
| GET | `/` | –í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ |
